{% comment %}
  Renders infinite scroll using Ajaxinate library.
  SEO-friendly: includes visible pagination links that work without JS.

  Usage:
  {% render 'infinite-scroll-loader', paginate: paginate %}

  Accepts:
  - paginate: {Object} Pagination object
{% endcomment %}

{%- comment -%}
  SEO: Add rel="next" and rel="prev" link tags for search engines
{%- endcomment -%}
{%- if paginate.previous -%}
  <link rel="prev" href="{{ paginate.previous.url }}">
{%- endif -%}
{%- if paginate.next -%}
  <link rel="next" href="{{ paginate.next.url }}">
{%- endif -%}

{%- comment -%}
  Ajaxinate pagination - contains just the next page link for infinite scroll.
  Hidden when there are no more pages.
{%- endcomment -%}
<div id="AjaxinatePagination" class="infinite-scroll">
  {%- if paginate.next -%}
    <a href="{{ paginate.next.url }}" class="infinite-scroll__link visually-hidden">
      {{ 'general.pagination.next' | t }}
    </a>
    <div class="infinite-scroll__spinner" aria-label="{{ 'accessibility.loading' | t }}">
      <svg
        aria-hidden="true"
        focusable="false"
        class="spinner"
        viewBox="0 0 66 66"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle class="spinner-path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
      </svg>
    </div>
  {%- else -%}
    <p class="infinite-scroll__complete">
      {{ 'sections.collection_template.no_more_products' | t }}
    </p>
  {%- endif -%}
</div>

{%- comment -%}
  SEO & Accessibility: Full pagination for crawlers and no-JS users.
  Hidden visually when JS runs but remains in DOM for SEO.
{%- endcomment -%}
<noscript>
  {% render 'pagination', paginate: paginate, anchor: '' %}
</noscript>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof Ajaxinate === 'undefined') return;

    new Ajaxinate({
      container: '#product-grid',
      pagination: '#AjaxinatePagination',
      offset: 300,
      loadingText: '{{ "accessibility.loading" | t }}'
    });
  });
</script>
