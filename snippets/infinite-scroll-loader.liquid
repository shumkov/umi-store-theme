{% comment %}
  Renders infinite scroll using custom IntersectionObserver + Section Rendering API.
  SEO-friendly: includes visible pagination links that work without JS.
  No-JS friendly: full pagination in noscript tag.
  Browser history: updates URL with page number.

  Usage:
  {% render 'infinite-scroll-loader', paginate: paginate, section_id: section.id %}

  Accepts:
  - paginate: {Object} Pagination object
  - section_id: {String} Section ID for Section Rendering API
{% endcomment %}

{%- comment -%}
  SEO: Add rel="next" and rel="prev" link tags for search engines
{%- endcomment -%}
{%- if paginate.previous -%}
  <link rel="prev" href="{{ paginate.previous.url }}">
{%- endif -%}
{%- if paginate.next -%}
  <link rel="next" href="{{ paginate.next.url }}">
{%- endif -%}

{%- comment -%}
  Infinite scroll custom element.
  Uses IntersectionObserver to detect when user scrolls near bottom.
  Fetches only section HTML via Section Rendering API (efficient).
{%- endcomment -%}
<infinite-scroll
  id="InfiniteScroll"
  class="infinite-scroll"
  data-section-id="{{ section_id }}"
  data-container="#product-grid"
>
  {%- if paginate.next -%}
    <a href="{{ paginate.next.url }}" class="infinite-scroll__link visually-hidden">
      {{ 'general.pagination.next' | t }}
    </a>
    <div class="infinite-scroll__spinner" aria-label="{{ 'accessibility.loading' | t }}">
      <svg
        aria-hidden="true"
        focusable="false"
        class="spinner"
        viewBox="0 0 66 66"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle class="spinner-path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
      </svg>
    </div>
  {%- else -%}
    <p class="infinite-scroll__complete">
      {{ 'sections.collection_template.no_more_products' | t }}
    </p>
  {%- endif -%}
</infinite-scroll>

{%- comment -%}
  SEO & Accessibility: Full pagination for crawlers and no-JS users.
  Hidden visually when JS runs but remains in DOM for SEO.
{%- endcomment -%}
<noscript>
  {% render 'pagination', paginate: paginate, anchor: '' %}
</noscript>
